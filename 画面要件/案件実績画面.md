# 案件実績画面要件書

## 機能

- 案件実績取得
- 案件実績登録
- 案件実績編集

## 画面仕様書

### 1. 画面名

画面名:案件実績画面
Path: /projectsAchievements/{id}

### 2. 画面概要

特定の案件のメンバー別の日単位の稼働時間の登録/編集ができる。  
特定の案件のメンバー別の日/週/月単位の稼働時間と金額を確認できる。

### 3. UI構成

レイアウト:

![案件実績画面(日毎)](案件実績画面(日毎)_20240911.png)
![案件実績画面(週毎)](案件実績画面(週毎)_20240911.png)
![案件実績画面(月毎)](案件実績画面(月毎)_20240911.png)

項目:

項目名|種別|型|必須|I/O|バリデーション|初期値|備考|
-----|----|----|----|----|----|----|----|
案件選択|プルダウン|文字列|-|I/O|-|-|選択肢は全てのプロジェクト名/プルダウン選択時に文字入力で検索可能(フロント側で制御)/内部的にはproject_idで管理|
対象期間 / 対象期間|テキスト|文字列|-|O|-|-|-|
対象期間 / 期間|プルダウン|文字列|-|I|-|日毎|選択肢['日毎','週毎','月毎']|
案件実績|テーブル|-|-|I|-|-|-|
案件実績 / 案件実績|テキスト|文字列|-|O|-|-|-|
案件実績 / 名前(列名)|テキスト|文字列|-|O|-|-|-|
案件実績 / 役職(列名)|テキスト|文字列|-|O|-|-|-|
案件実績 / 原価(列名)|テキスト|文字列|-|O|-|-|-|
案件実績 / 名前(行)|テキスト|文字列|-|O|-|-|membersテーブルのname|
案件実績 / 役職(行)|テキスト|文字列|-|O|-|-|assignment_membersテーブルのposition|
案件実績 / 原価(行)|テキスト|文字列|-|O|-|-|フォーマット: ¥ XXX,XXX/membersテーブルのbase_cost|
案件実績 / 矢印|ボタン|-|-|I/O|-|-|-|
案件実績 / 日付|テキスト|日付|-|O|-|-|土日祝日は色を変える(土:水色(#78C6DE)/祝日&日:赤色(#EA7777))/週毎の場合は週の月曜日から「YYYY/MM/DD~」と表示/月毎の場合は「YYYY/MM」と表示|
案件実績 / 時間|テキスト|文字列|-|O|-|-|-|
案件実績 / 時間入力テキストボックス|テキストボックス|インターバル|-|I|-|-|対象期間が週毎/月毎の場合は編集・登録不可|
案件実績 / 金額|テキスト|文字列|-|O|-|-|-|
案件実績 / 金額(実績値)|テキスト|文字列|-|O|-|-|フォーマット: ¥ XXX,XXX/時間入力テキストボックスの入力完了後に原価(行)を用いて自動計算(原価(行)/160×時間入力テキストボックスの値)|
登録|ボタン|-|-|I|-|-|-|
<!-- 表示期間 / 表示期間|テキスト|文字列|-|O|-|-|-|
表示期間 / 矢印|ボタン|-|-|I/O|-|-|-|
表示期間 / 開始日|デイトピッカー|日付|-|I/O|-|-|フォーマット: YYYY/MM/DD/週毎の場合は週で選択するデイトピッカーにする/月毎の場合は月で選択するデイトピッカーにする|
表示期間 / ~|テキスト|文字列|-|O|-|-|-|
表示期間 / 終了日|デイトピッカー|日付|-|I/O|-|-|フォーマット: YYYY/MM/DD| -->

### 4. イベント

- 初期表示
  - 案件選択は現時点以降の終了日が最も近いデータを表示
  - 対象期間は日毎で表示
  - 表示期間は当日の日付を含む週の月曜日からの7日間を表示
  - 案件選択で選択されているプロジェクトのメンバーの情報を表示
  - 案件実績の日付は当日の日付を含む週の月曜日からの7日間を表示
- 案件選択のプルダウンでプロジェクトを選択する
  - 対象期間の期間を日毎に変更する
  - 選択されたプロジェクトの情報を表示
- 対象期間の期間を変更する
  - 案件実績の内容を選択された期間に変更する(API取得している既存のデータで週毎/月毎のデータを作成)
<!-- - 表示期間の矢印を押下する
  - 対象期間の期間が日毎の場合: 表示期間の開始日と最終日を次/前の週の値に変更する ※表示期間は一週間以下は選択できないものとする
  - 対象期間の期間が週毎の場合: 表示期間の開始日を最終日+1の値に変更の上、終了日を(最終日- 開始日)の期間分プラスして変更する ※表示期間は一週間以下は選択できないものとする
  - 対象期間の期間が週毎の場合: 表示期間の開始日を最終日+1の値に変更の上、終了日を(最終日- 開始日)の期間分プラスして変更する ※表示期間は一週間以下は選択できないものとする
  - 設定された開始日と終了日に合わせて案件実績取得APIにリクエストを送り、案件実績を再取得
- 表示期間の開始日を変更する
  - 設定された開始日と終了日に合わせて案件実績取得APIにリクエストを送り、案件実績を再取得
- 表示期間の終了日を変更する
  - 設定された開始日と終了日に合わせて案件実績取得APIにリクエストを送り、案件実績を再取得 -->
- 案件実績の矢印を押下する
  - 前の週の開始日と終了日に合わせて案件実績取得APIにリクエストを送り、案件実績を再取得
- 案件実績の時間入力テキストボックスに時間を入力する
  - 金額の値を自動計算する
- 登録するボタンを押下する
  - 案件実績編集APIにリクエスト送り、案件実績取得APIから案件実績を再取得

## API仕様書

### 1. API一覧

API名|HTTPメソッド|URI|説明|
-----|----|----|----|
案件実績取得|GET|/v1/projectsAchievements/{id}|案件実績情報を取得する/クエリストリングに日付の範囲を含み取得を行う|
案件実績編集|POST|/v1/projectsAchievements/{id}|案件実績情報をwork_costsに登録する|

### 2. リクエスト仕様

#### 案件実績取得

##### リクエストパラメータ

パラメータ名|型|必須/任意|デフォルト値|備考|
-----|----|----|----|----|
-|-|-|-|-|

###### リクエストボディ例

```json

```

#### 案件実績編集

##### リクエストパラメータ

パラメータ名|型|必須/任意|デフォルト値|備考|
-----|----|----|----|----|
projects{|object|◯|-|-|
id|int|◯|-|-|
assignment_members[|array|◯|-|案件アサインメンバー|
member_id|int|◯|-|-|
position|int|◯|-|役職|
work_costs[|array|◯|-|原価|
daily_cost|int|◯|-|その日あたりの原価|
work_time|int|◯|-|その日のあたりの工数(時間)|
work_date|date|◯|-|-|
work_costs]|array|◯|-|-|
assignment_members]|array|◯|-|-|
projects}|object|◯|-|-|

###### リクエストボディ例

```json
{
    "projects":  {
        "id": 1,
        "assignment_members": [
          {
            "member_id": 1,
            "position": 1,
            "work_costs": [
              {
                "daily_cost": 40000,
                "work_time": 8,
                "work_date": "2024/09/02",
              },
              ...,
            ]
          },
          ...,
        ]
    }
}
```

### 3. レスポンス仕様

#### 案件実績取得

ステータスコード: `200`

##### レスポンスフィールド

パラメータ名|型|備考|
-----|----|----|
projects{|object|-|
id|int|-|
assignment_members[|array|案件アサインメンバー|
member_id|int|-|
position|int|役職|
base_cost|int|原価|
work_costs[|array|原価|
daily_cost|int|その日あたりの原価|
work_time|int|その日のあたりの工数(時間)|
work_date|date|-|
work_costs]|array|-|
assignment_members]|array|-|
projects}|object|-|

##### レスポンス例

```json
{
    "projects":  {
        "id": 1,
        "assignment_members": [
          {
            "member_id": 1,
            "position": 1,
            "base_cost": 800000,
            "work_costs": [
              {
                "daily_cost": 40000,
                "work_time": "08:00:00",
                "work_date": "2024/09/02",
              },
              ...,
            ]
          },
          ...,
        ]
    }
}
```

##### エラーレスポンス

エラーコード|メッセージ例|説明|
-----|----|----|
400|リクエストの値が不正です。|不正な値に関しても返却|

##### エラーレスポンス例

```json
{
  "errors": {
        "start_date": [
            "開始日の値が不正です。"
        ]
    }
}
```

#### 案件実績編集

ステータスコード: `204`

##### レスポンスフィールド

フィールド名|型|備考|
-----|----|----|
-|-|-|

##### レスポンス例

```json
[]
```

##### エラーレスポンス

エラーコード|メッセージ例|説明|
-----|----|----|
400|リクエストの値が不正です。|不正な値に関しても返却|

##### エラーレスポンス例

```json
{
  "errors": {
        "work_date": [
            "作業日の値が不正です。"
        ]
    }
}
```

### 4. 備考

備考:
